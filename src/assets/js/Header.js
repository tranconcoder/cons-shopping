(()=>{"use strict";const t=(t,e=document)=>e.querySelector(t),e=class{constructor(){this.notify={required:"Không được để trống trường này!",minLength:t=>"Độ dài tối thiểu từ "+t+" ký tự!",maxLength:t=>"Độ dài tối đa là "+t+" ký tự!",equalLength:t=>"Độ dài phải là "+t+"!",secureLevel1:"Phải bao gồm số, ký tự hoa, thường và ký tự đặc biệt",numberOnly:"Chỉ cho phép nhập số!",notSymbolCheck:"Không nhập ký tự đặc biệt vào trường này",isEmail:"Không đúng định dạng Email, vui lòng nhập lại!",requiredSymbol:"Trường này bắt buộc chứa ký tự đặc biệt",requiredUpper:"Trường này bắt buộc chứa ký tự in ho",requiredLower:"Trường này bắt buộc chứa ký tự in thường",requiredNumber:"Trường này bắt buộc chứa chữ số",equalInputValue:t=>"Giá trị vừa nhập không khớp với trường "+t+"!"}}required(t){return 0==t.length&&this.notify.required}lengthCheck(t,e,n){return"min"===e&&t.length<n?this.notify.minLength(n):"max"===e&&t.length>n?this.notify.maxLength(n):"equal"===e&&t.length!==n&&this.notify.equalLength(n)}notSymbolCheck(t){return!new RegExp(/^[A-Za-z0-9]*$/).test(t)&&this.notify.notSymbolCheck}requiredSymbol(t){return!/[-!$%^&*()_+|~=`{}\[\]:\/;<>?,.@#]/.test(t)&&this.notify.requiredSymbol}requiredLower(t){return!/[a-z]/.test(t)&&this.notify.requiredLower}requiredUpper(t){return!/[A-Z]/.test(t)&&this.notify.requiredUpper}requiredNumber(t){return!/[0-9]/.test(t)&&this.notify.requiredNumber}numberOnly(t){return!/^[0-9]*$/.test(t)&&this.notify.numberOnly}isEmail(t){return!/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-za-z\-0-9]+\.)+[a-za-z]{2,}))$/.test(t.toLowerCase())&&this.notify.isEmail}secureLevel1(t){const e=this.lengthCheck(t,"min",8);if(e)return e;const n=this.requiredSymbol(t),s=this.requiredNumber(t),i=this.requiredLower(t),r=this.requiredUpper(t);return!!(n||s||i||r)&&this.notify.secureLevel1}equalInputValue(t,e,n){return t!==e.value&&this.notify.equalInputValue(n)}setError(t,e){var n;const s=null===(n=t.parentElement)||void 0===n?void 0:n.parentElement,i=s.querySelector(".error-message");return s.classList.add("error"),i.textContent=e,!1}removeError(t){var e;const n=null===(e=t.parentElement)||void 0===e?void 0:e.parentElement;n.querySelector(".error-message").textContent="",n.classList.remove("error")}checkInputValues(t,e){const n=t.value;if(e.required){const e=this.required(n);if(e)return this.setError(t,e)}else if(0===n.length)return this.removeError(t),!0;if(e.isEmail){const e=this.isEmail(n);if(e)return this.setError(t,e)}if(e.numberOnly){const e=this.numberOnly(n);if(e)return this.setError(t,e)}if(e.notSymbol){const e=this.notSymbolCheck(n);if(e)return this.setError(t,e)}if(e.secureLevel1){const e=this.secureLevel1(n);if(e)return this.setError(t,e)}if(e.equalLength){const s=this.lengthCheck(n,"equal",e.equalLength);if(s)return this.setError(t,s)}if(e.minLength){const s=this.lengthCheck(n,"min",e.minLength);if(s)return this.setError(t,s)}if(e.maxLength){const s=this.lengthCheck(n,"max",e.maxLength);if(s)return this.setError(t,s)}if(e.equalInputValue){const s=this.equalInputValue(n,e.equalInputValue.inputToCompare,e.equalInputValue.inputLabel);if(s)return this.setError(t,s)}return this.removeError(t),!0}listenAndValidateInput(t,e){t.addEventListener("focusout",(n=>{this.checkInputValues(t,e)}))}resetForm(){const t=Object.getOwnPropertyNames(this);t.filter((t=>this[t]instanceof HTMLFormElement)).map((t=>this[t])).forEach((t=>{t.reset()})),t.filter((t=>this[t]instanceof HTMLInputElement)).map((t=>this[t])).forEach((t=>{this.removeError(t)}))}},n=class extends e{constructor(){super(),this.formElm=t(".authenticate-ctn .form-ctn.login"),this.usernameInput=t("#username-input"),this.passwordInput=t("#password-input")}listenEvent(){const t={required:!0,minLength:6,maxLength:24,notSymbol:!0},e={required:!0,secureLevel1:!0};this.listenAndValidateInput(this.usernameInput,t),this.listenAndValidateInput(this.passwordInput,e),this.formElm.addEventListener("submit",(n=>{const s=this.checkInputValues(this.usernameInput,t),i=this.checkInputValues(this.passwordInput,e);s&&i||n.preventDefault()}))}},s=class extends e{constructor(){super(),this.formElm=t(".authenticate-ctn .form-ctn.register"),this.usernameInput=t("#username-register-input"),this.passwordInput=t("#password-register-input"),this.retypePasswordInput=t("#retype-password-input"),this.firstNameInput=t("#first-name-input"),this.lastNameInput=t("#last-name-input"),this.addressInput=t("#address-input"),this.phoneNumberInput=t("#phone-number-input"),this.gmailInput=t("#gmail-input")}listenEvent(){const t={required:!0,minLength:6,maxLength:16,notSymbol:!0},e={required:!0,minLength:8,maxLength:36,secureLevel1:!0},n=Object.assign(Object.assign({},e),{equalInputValue:{value:this.retypePasswordInput.value,inputLabel:"mật khẩu",inputToCompare:this.passwordInput}}),s={required:!0,minLength:2,maxLength:8,notSymbol:!0},i={required:!0,minLength:2,maxLength:8,notSymbol:!0},r={required:!0,minLength:10,maxLength:120},h={required:!0,numberOnly:!0,equalLength:10},u={isEmail:!0};this.listenAndValidateInput(this.usernameInput,t),this.listenAndValidateInput(this.passwordInput,e),this.listenAndValidateInput(this.retypePasswordInput,n),this.listenAndValidateInput(this.firstNameInput,s),this.listenAndValidateInput(this.lastNameInput,i),this.listenAndValidateInput(this.addressInput,r),this.listenAndValidateInput(this.phoneNumberInput,h),this.listenAndValidateInput(this.gmailInput,u),this.formElm.addEventListener("submit",(a=>{const o=this.checkInputValues(this.usernameInput,t),l=this.checkInputValues(this.passwordInput,e),c=this.checkInputValues(this.retypePasswordInput,n),d=this.checkInputValues(this.firstNameInput,s),p=this.checkInputValues(this.lastNameInput,i),m=this.checkInputValues(this.addressInput,r),g=this.checkInputValues(this.phoneNumberInput,h),I=this.checkInputValues(this.gmailInput,u);o&&l&&c&&d&&p&&m&&g&&I||a.preventDefault()}))}};new class{constructor(){this.focusing=!1,this.searchBox=t("#search-box"),this.searchInput=t(".search-input"),this.submitButton=t(".search-input ~ .submit-button"),this.searchProductListElm=t(".search-products__list",this.searchBox),this.listenAndHandleEvent()}listenAndHandleEvent(){this.listenAndHandleSubmit(),this.listenAndHandleSearch()}listenAndHandleSearch(){this.handleSearchProduct(),this.searchInput.addEventListener("input",this.handleSearchProduct.bind(this))}listenAndHandleSubmit(){this.searchInput.addEventListener("focusin",(()=>{window.addEventListener("keypress",this.handleSubmitByKeyPress.bind(this))})),this.searchInput.addEventListener("focusout",(()=>{window.removeEventListener("keypress",this.handleSubmitByKeyPress.bind(this))})),this.submitButton.addEventListener("click",this.handleSubmit.bind(this))}handleSearchProduct(){clearInterval(Number(this.timeoutIdSubmitAfterStopInputSearch)),this.timeoutIdSubmitAfterStopInputSearch=setTimeout((()=>{return t=this,e=void 0,s=function*(){if(!this.searchInput.value)return this.searchProductListElm.innerHTML="";const t=`/api/search-product?q=${this.searchInput.value}`,e=yield fetch(t,{method:"GET"}).then((t=>t.json()));this.renderSearchProducts(e)},new((n=void 0)||(n=Promise))((function(i,r){function h(t){try{a(s.next(t))}catch(t){r(t)}}function u(t){try{a(s.throw(t))}catch(t){r(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(h,u)}a((s=s.apply(t,e||[])).next())}));var t,e,n,s}),500)}handleSubmitByKeyPress(t){"Enter"===t.code&&this.handleSubmit()}handleSubmit(){this.searchInput.value=this.searchInput.value.replace(/[^\w\s]/gi,""),this.searchInput.value.trim().length&&(window.location.href="/search?q="+this.searchInput.value)}renderSearchProducts(t){this.searchProductListElm.innerHTML="",t.forEach((t=>{const e=document.createElement("li");e.innerHTML=`\n                <a href="/product?id=${t.productId}">\n                    <img\n                        src="${t.thumb||""}"\n                        alt="thumb"\n                    >\n                        \n                    <h4>${t.label}</h4>\n                </a>\n            `,this.searchProductListElm.appendChild(e)}))}},(new n).listenEvent(),(new s).listenEvent();const i=new class{constructor(){this.loginForm=new n,this.registerForm=new s,this.checkboxToShowBox=t("#toggle-register-auth-box")}listenChangeFormInput(){this.loginForm.listenEvent(),this.registerForm.listenEvent()}listenEventToShowAndHideBox(){this.checkboxToShowBox.addEventListener("change",(()=>{this.loginForm.resetForm(),this.registerForm.resetForm()}))}};i.listenChangeFormInput(),i.listenEventToShowAndHideBox()})();