(()=>{"use strict";var e,t,n={858:(e,t,n)=>{n.d(t,{$:()=>i,$$:()=>a});const i=(e,t=document)=>t.querySelector(e),a=(e,t=document)=>t.querySelectorAll(e)}},i={};function a(e){var t=i[e];if(void 0!==t)return t.exports;var o=i[e]={exports:{}};return n[e](o,o.exports,a),o.exports}a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e=a(858),t=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{s(i.next(e))}catch(e){o(e)}}function d(e){try{s(i.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,d)}s((i=i.apply(e,t||[])).next())}))},(new class{constructor(){this.changeInfoPreviousValue="",this.updateImageBoxStateInput=(0,e.$)("#update-image-box-state"),this.inputFileImageList=(0,e.$$)(".home-image-slide tbody .thumb input"),this.updateImagePreviewImg=(0,e.$)("#preview-img"),this.updateImageBoxAcceptButton=(0,e.$)(".update-image-box .button-list .accept"),this.removeImageButtonList=(0,e.$$)(".home-image-slide tbody tr .action > button"),this.imageInfoInputList=(0,e.$$)('.home-image-slide tbody tr td input[type="text"] , .home-image-slide tbody tr td input[type="number"]')}listenEvent(){this.inputFileImageList.forEach((e=>{e.addEventListener("change",this.handleChangeFileInput.bind(this))})),this.removeImageButtonList.forEach((e=>{e.addEventListener("click",this.removeImageSlide.bind(this))})),this.updateImageBoxAcceptButton.addEventListener("click",(t=>{var n,i;const a=(0,e.$)(`input[data-id="${this.updateImagePreviewImg.dataset.id}"]`);(null===(n=a.files)||void 0===n?void 0:n.length)&&(null===(i=this.updateImagePreviewImg.dataset.id)||void 0===i?void 0:i.length)&&this.submitNewImage(null==a?void 0:a.files[0],a.dataset.id)})),this.imageInfoInputList.forEach((e=>{e.addEventListener("focusin",(e=>{this.changeInfoPreviousValue=e.target.value}))})),this.imageInfoInputList.forEach((e=>{e.addEventListener("change",this.changeImageInfo.bind(this))}))}handleChangeFileInput(e){const t=e.target.files[0],n=URL.createObjectURL(t),i=e.target.previousElementSibling;this.updateImageBoxStateInput.checked=!0,this.updateImagePreviewImg.src=n,this.updateImagePreviewImg.dataset.id=e.target.dataset.id,i.src=n}submitNewImage(e,t){const n=new FormData;n.append("id",t),n.append("file",e),fetch("/api/change-image-slider",{method:"POST",body:n}).then((e=>e.json())).then((e=>{!0===e&&(alert("Success!"),this.updateImageBoxStateInput.checked=!1)})).catch((e=>console.log(e)))}removeImageSlide(e){if(!confirm("Bạn có muốn xóa ảnh này không?"))return;const t=e.target.dataset.id,n=new FormData;n.append("imageId",t),fetch("/api/remove-image-slider",{method:"POST",body:n}).then((e=>e.json())).then((t=>{!t.error&&t&&e.target.parentElement.parentElement.remove()}))}changeImageInfo(e){const t=e.target,n=(t.name,t.value);let i=t;for(;!(i instanceof HTMLTableRowElement);)i=i.parentNode;const a=i.dataset.id,o=new FormData;o.append("imageId",a),o.append("field",t.name),o.append("newValue",n.toString()),fetch("/api/update-info-image-slider",{method:"POST",body:o}).then((e=>e.json())).then((e=>{"Error: Order is used"==e.message&&(confirm("STT mới đã được sử dụng, bạn có muốn hoán đổi vị trí 2 ảnh này không?")?this.handleSwapOrderImage(n,this.changeInfoPreviousValue):t.value=this.changeInfoPreviousValue)})).catch((e=>console.error("Error: ",e)))}handleSwapOrderImage(e,t){const n=new FormData;n.append("order1",e.toString()),n.append("order2",t.toString()),fetch("/api/swap-order-image-slider",{method:"POST",body:n}).then((e=>e.json())).then((e=>{e.error||window.location.reload()})).catch((e=>console.log(e)))}}).listenEvent(),(new class{constructor(){this.addNewImageForm=(0,e.$)(".home-image-slide form.add-new-image"),this.imageNameInput=(0,e.$)('input[type="text"]',this.addNewImageForm),this.imageFileInput=(0,e.$)('input[type="file"]',this.addNewImageForm),this.submitNewImageButton=(0,e.$)("button.submit",this.addNewImageForm)}listenEvent(){this.imageNameInput.addEventListener("focusout",(t=>{var n;const i=t.target,a=null===(n=i.parentElement)||void 0===n?void 0:n.parentElement,o=(0,e.$)(".error-message",a);i.value.length?a.classList.remove("error"):(a.classList.add("error"),o.textContent="Vui lòng nhập tên hình ảnh!")})),this.addNewImageForm.addEventListener("submit",(t=>{var n;t.preventDefault();const i=t.target,a=null===(n=this.imageNameInput.parentElement)||void 0===n?void 0:n.parentElement,o=(0,e.$)(".error-message",a);this.imageNameInput.value.length?i.submit():(a.classList.add("error"),o.textContent="Vui lòng nhập tên hình ảnh!")}))}}).listenEvent(),(new class{constructor(){this.productImagesRow=(0,e.$)("section.section-2 table tbody tr"),this.productListItem=(0,e.$$)(".product-list-container .product-item")}listenEvent(){this.productListItem.forEach((t=>{(0,e.$)("button.delete",t).addEventListener("click",this.handleRemoveItem.bind(this))})),this.productListItem.forEach((t=>{(0,e.$)("label.change-info",t).addEventListener("click",this.handleOpenChangeBox.bind(this))})),this.productImagesRow.addEventListener("change",this.handleChangeImage.bind(this))}handleRemoveItem(e){if(!confirm("Bạn có muốn XÓA sản phẩm khỏi danh sách không?"))return;const t=e.target.parentElement,n=t.dataset.id,i=new FormData;i.append("productId",n),fetch("/api/remove-product",{method:"POST",body:i}).then((e=>e.json())).then((e=>{e.error||t.remove()})).catch((e=>console.log(e)))}handleOpenChangeBox(n){var i,a,o,r,d,s,h,l;return t(this,void 0,void 0,(function*(){let t=n.target;for(;!(t instanceof HTMLLIElement);)t=t.parentElement;const c=t.dataset.id,m=(0,e.$)("#change-product-info-state + .change-product-info"),u=yield this.getProductInfo(c),g=yield this.getAllDeal(),p=yield this.getProductImages(c),v=(0,e.$)('input[name="productId"]'),I=(0,e.$)("img.thumb",m),f=(0,e.$)('input[name="label"]',m),b=(0,e.$)('input[name="cost"]'),$=(0,e.$)('select[name="deal"]');I.src=u.thumb||"",b.value=u.cost.toString(),f.value=u.label,g.forEach((e=>{const t=document.createElement("option");t.value=e.dealId,t.innerText=e.title,e.dealId===u.dealId&&(t.selected=!0),$.appendChild(t)})),v.value=c,this.productImagesRow.innerHTML="<th>Hình ảnh</th>",p.forEach((e=>{const t=document.createElement("td");t.innerHTML=`\n                <label>\n                    <input\n                        type="file"\n                        data-id="${e.imageId}"\n                        accept="image/png, image/jpg, image/jpeg"\n                        hidden\n                    />\n                    <img src="${e.source}" />\n                </label>\n            `,this.productImagesRow.appendChild(t)}));const w=(0,e.$)('input[name="sizeWidth"]'),E=(0,e.$)('input[name="sizeHeight"]'),y=(0,e.$)('input[name="monitorWidth"]'),L=(0,e.$)('input[name="monitorHeight"]'),S=(0,e.$)('input[name="processor"]'),P=(0,e.$)('input[name="memory"]'),x=(0,e.$)('input[name="storage"]'),F=(0,e.$)('input[name="color"]');w.value=(null===(i=u.sizeWidth)||void 0===i?void 0:i.toString())||"",E.value=(null===(a=u.sizeHeight)||void 0===a?void 0:a.toString())||"",y.value=(null===(o=u.monitorWidth)||void 0===o?void 0:o.toString())||"",L.value=(null===(r=u.monitorHeight)||void 0===r?void 0:r.toString())||"",S.value=(null===(d=u.processor)||void 0===d?void 0:d.toString())||"",P.value=(null===(s=u.memory)||void 0===s?void 0:s.toString())||"",x.value=(null===(h=u.storage)||void 0===h?void 0:h.toString())||"",F.value=(null===(l=u.color)||void 0===l?void 0:l.toString())||""}))}handleChangeImage(e){const t=e.target,n=t.dataset.id,i=(null==t?void 0:t.files)[0],a=new FormData;a.append("imageFile",i),a.append("imageId",n),fetch("/api/change-image",{method:"POST",body:a}).then((e=>e.json())).then((e=>{e.error})).catch((e=>console.log(e)))}getAllDeal(){return t(this,void 0,void 0,(function*(){return fetch("/api/get-all-deal").then((e=>e.json())).then((e=>e))}))}getProductImages(e){return t(this,void 0,void 0,(function*(){return fetch("/api/get-product-images?productId="+e).then((e=>e.json())).then((e=>e)).catch((e=>console.log(e)))}))}getProductInfo(e){return t(this,void 0,void 0,(function*(){const t="/api/get-product?productId="+e;return yield fetch(t).then((e=>e.json())).then((e=>e[0])).catch((e=>console.error(e)))}))}}).listenEvent()})();