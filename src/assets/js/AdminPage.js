(()=>{"use strict";var e,t,n={858:(e,t,n)=>{n.d(t,{$:()=>a,$$:()=>i});const a=(e,t=document)=>t.querySelector(e),i=(e,t=document)=>t.querySelectorAll(e)}},a={};function i(e){var t=a[e];if(void 0!==t)return t.exports;var o=a[e]={exports:{}};return n[e](o,o.exports,i),o.exports}i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e=i(858),t=function(e,t,n,a){return new(n||(n=Promise))((function(i,o){function r(e){try{s(a.next(e))}catch(e){o(e)}}function d(e){try{s(a.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,d)}s((a=a.apply(e,t||[])).next())}))},(new class{constructor(){this.changeInfoPreviousValue="",this.updateImageBoxStateInput=(0,e.$)("#update-image-box-state"),this.inputFileImageList=(0,e.$$)(".home-image-slide tbody .thumb input"),this.updateImagePreviewImg=(0,e.$)("#preview-img"),this.updateImageBoxAcceptButton=(0,e.$)(".update-image-box .button-list .accept"),this.removeImageButtonList=(0,e.$$)(".home-image-slide tbody tr .action > button"),this.imageInfoInputList=(0,e.$$)('.home-image-slide tbody tr td input[type="text"] , .home-image-slide tbody tr td input[type="number"]')}listenEvent(){this.inputFileImageList.forEach((e=>{e.addEventListener("change",this.handleChangeFileInput.bind(this))})),this.removeImageButtonList.forEach((e=>{e.addEventListener("click",this.removeImageSlide.bind(this))})),this.updateImageBoxAcceptButton.addEventListener("click",(t=>{var n,a;const i=(0,e.$)(`input[data-id="${this.updateImagePreviewImg.dataset.id}"]`);(null===(n=i.files)||void 0===n?void 0:n.length)&&(null===(a=this.updateImagePreviewImg.dataset.id)||void 0===a?void 0:a.length)&&this.submitNewImage(null==i?void 0:i.files[0],i.dataset.id)})),this.imageInfoInputList.forEach((e=>{e.addEventListener("focusin",(e=>{this.changeInfoPreviousValue=e.target.value}))})),this.imageInfoInputList.forEach((e=>{e.addEventListener("change",this.changeImageInfo.bind(this))}))}handleChangeFileInput(e){const t=e.target.files[0],n=URL.createObjectURL(t),a=e.target.previousElementSibling;this.updateImageBoxStateInput.checked=!0,this.updateImagePreviewImg.src=n,this.updateImagePreviewImg.dataset.id=e.target.dataset.id,a.src=n}submitNewImage(e,t){const n=new FormData;n.append("id",t),n.append("file",e),fetch("/api/change-image-slider",{method:"POST",body:n}).then((e=>e.json())).then((e=>{!0===e&&(alert("Success!"),this.updateImageBoxStateInput.checked=!1)})).catch((e=>console.log(e)))}removeImageSlide(e){if(!confirm("Bạn có muốn xóa ảnh này không?"))return;const t=e.target.dataset.id,n=new FormData;n.append("imageId",t),fetch("/api/remove-image-slider",{method:"POST",body:n}).then((e=>e.json())).then((t=>{!t.error&&t&&e.target.parentElement.parentElement.remove()}))}changeImageInfo(e){const t=e.target,n=(t.name,t.value);let a=t;for(;!(a instanceof HTMLTableRowElement);)a=a.parentNode;const i=a.dataset.id,o=new FormData;o.append("imageId",i),o.append("field",t.name),o.append("newValue",n.toString()),fetch("/api/update-info-image-slider",{method:"POST",body:o}).then((e=>e.json())).then((e=>{"Error: Order is used"==e.message&&(confirm("STT mới đã được sử dụng, bạn có muốn hoán đổi vị trí 2 ảnh này không?")?this.handleSwapOrderImage(n,this.changeInfoPreviousValue):t.value=this.changeInfoPreviousValue)})).catch((e=>console.error("Error: ",e)))}handleSwapOrderImage(e,t){const n=new FormData;n.append("order1",e.toString()),n.append("order2",t.toString()),fetch("/api/swap-order-image-slider",{method:"POST",body:n}).then((e=>e.json())).then((e=>{e.error||window.location.reload()})).catch((e=>console.log(e)))}}).listenEvent(),(new class{constructor(){this.addNewImageForm=(0,e.$)(".home-image-slide form.add-new-image"),this.imageNameInput=(0,e.$)('input[type="text"]',this.addNewImageForm),this.imageFileInput=(0,e.$)('input[type="file"]',this.addNewImageForm),this.submitNewImageButton=(0,e.$)("button.submit",this.addNewImageForm)}listenEvent(){this.imageNameInput.addEventListener("focusout",(t=>{var n;const a=t.target,i=null===(n=a.parentElement)||void 0===n?void 0:n.parentElement,o=(0,e.$)(".error-message",i);a.value.length?i.classList.remove("error"):(i.classList.add("error"),o.textContent="Vui lòng nhập tên hình ảnh!")})),this.addNewImageForm.addEventListener("submit",(t=>{var n;t.preventDefault();const a=t.target,i=null===(n=this.imageNameInput.parentElement)||void 0===n?void 0:n.parentElement,o=(0,e.$)(".error-message",i);this.imageNameInput.value.length?a.submit():(i.classList.add("error"),o.textContent="Vui lòng nhập tên hình ảnh!")}))}}).listenEvent(),(new class{constructor(){this.productImagesRow=(0,e.$)("section.section-2 table tbody tr"),this.productListItem=(0,e.$$)(".product-list-container .product-item"),this.addProductImageInput=(0,e.$)("#add-product-image")}listenEvent(){this.productListItem.forEach((t=>{(0,e.$)("button.delete",t).addEventListener("click",this.handleRemoveItem.bind(this))})),this.productListItem.forEach((t=>{(0,e.$)("label.change-info",t).addEventListener("click",this.handleOpenChangeBox.bind(this))})),this.productImagesRow.addEventListener("change",this.handleChangeImage.bind(this)),this.productImagesRow.addEventListener("click",this.handleRemoveImage.bind(this)),this.addProductImageInput.addEventListener("change",this.handleAddProductImage.bind(this))}handleRemoveItem(e){if(!confirm("Bạn có muốn XÓA sản phẩm khỏi danh sách không?"))return;const t=e.target.parentElement,n=t.dataset.id,a=new FormData;a.append("productId",n),fetch("/api/remove-product",{method:"POST",body:a}).then((e=>e.json())).then((e=>{e.error||t.remove()})).catch((e=>console.log(e)))}handleOpenChangeBox(n){var a,i,o,r,d,s,l,c;return t(this,void 0,void 0,(function*(){let t=n.target;for(;!(t instanceof HTMLLIElement);)t=t.parentElement;const h=t.dataset.id,m=(0,e.$)("#change-product-info-state + .change-product-info"),u=yield this.getProductInfo(h),g=yield this.getAllDeal(),p=yield this.getProductImages(h),v=(0,e.$)('input[name="productId"]'),I=(0,e.$)("img.thumb",m),f=(0,e.$)('input[name="label"]',m),b=(0,e.$)('input[name="cost"]'),E=(0,e.$)('select[name="deal"]');I.src=u.thumb||"",b.value=u.cost.toString(),f.value=u.label,g.forEach((e=>{const t=document.createElement("option");t.value=e.dealId,t.innerText=e.title,e.dealId===u.dealId&&(t.selected=!0),E.appendChild(t)})),v.value=h,this.productImagesRow.innerHTML="<th>Hình ảnh</th>",p.forEach((e=>{const t=document.createElement("td");t.innerHTML=`\n                <span>\n                    <i class="fa-solid fa-xmark"></i>\n                </span>\n\n                <label>\n                    <input\n                        type="file"\n                        accept="image/png, image/jpg, image/jpeg"\n                        hidden\n                    />\n                    <img src="${e.source}" />\n                </label>\n            `,t.dataset.id=e.imageId,this.productImagesRow.appendChild(t)}));const w=(0,e.$)('input[name="sizeWidth"]'),$=(0,e.$)('input[name="sizeHeight"]'),L=(0,e.$)('input[name="monitorWidth"]'),y=(0,e.$)('input[name="monitorHeight"]'),S=(0,e.$)('input[name="processor"]'),P=(0,e.$)('input[name="memory"]'),x=(0,e.$)('input[name="storage"]'),T=(0,e.$)('input[name="color"]');w.value=(null===(a=u.sizeWidth)||void 0===a?void 0:a.toString())||"",$.value=(null===(i=u.sizeHeight)||void 0===i?void 0:i.toString())||"",L.value=(null===(o=u.monitorWidth)||void 0===o?void 0:o.toString())||"",y.value=(null===(r=u.monitorHeight)||void 0===r?void 0:r.toString())||"",S.value=(null===(d=u.processor)||void 0===d?void 0:d.toString())||"",P.value=(null===(s=u.memory)||void 0===s?void 0:s.toString())||"",x.value=(null===(l=u.storage)||void 0===l?void 0:l.toString())||"",T.value=(null===(c=u.color)||void 0===c?void 0:c.toString())||""}))}handleChangeImage(t){if(!confirm("Xác nhận đổi ảnh mới?"))return;const n=t.target;let a=n;for(;!(a instanceof HTMLTableCellElement);)a=a.parentElement;const i=(0,e.$)("img",a),o=a.dataset.id,r=(null==n?void 0:n.files)[0],d=new FormData;d.append("imageFile",r),d.append("imageId",o),fetch("/api/change-image",{method:"POST",body:d}).then((e=>e.json())).then((e=>{e.error||(i.src=URL.createObjectURL(r))})).catch((e=>console.log(e)))}handleRemoveImage(e){var t;let n=e.target;for(;!(n instanceof HTMLSpanElement||n instanceof HTMLTableRowElement);)n=n.parentElement;if("span"!==n.tagName.toLowerCase())return;let a=n;for(;!(a instanceof HTMLTableCellElement);)a=a.parentElement;const i=a.dataset.id;if(((null===(t=a.parentElement)||void 0===t?void 0:t.childElementCount)||1)-1<2)return alert("Phải để lại ít nhất 1 hình ảnh cho mỗi sản phẩm!");this.removeImage(i,a)}handleAddProductImage(t){const n=t.target,a=(0,e.$)('input[name="productId"]').value,i=new FormData,o=(null==n?void 0:n.files)[0];i.append("file",o),i.append("productId",a),fetch("/api/add-product-image",{method:"POST",body:i}).then((e=>e.json())).then((e=>{if(!e.error){const t=document.createElement("td");t.innerHTML=`\n                        <span>\n                            <i class="fa-solid fa-xmark"></i>\n                        </span>\n\n                        <label>\n                            <input\n                                type="file"\n                                accept="image/png, image/jpg, image/jpeg"\n                                hidden\n                            />\n                            <img src="${URL.createObjectURL(o)}" />\n                        </label>\n                    `,t.dataset.id=e.newId,this.productImagesRow.appendChild(t)}})).catch((e=>console.log(e)))}getAllDeal(){return t(this,void 0,void 0,(function*(){return fetch("/api/get-all-deal").then((e=>e.json())).then((e=>e))}))}getProductImages(e){return t(this,void 0,void 0,(function*(){return fetch("/api/get-product-images?productId="+e).then((e=>e.json())).then((e=>e)).catch((e=>console.log(e)))}))}getProductInfo(e){return t(this,void 0,void 0,(function*(){const t="/api/get-product?productId="+e;return yield fetch(t).then((e=>e.json())).then((e=>e[0])).catch((e=>console.error(e)))}))}removeImage(e,n){return t(this,void 0,void 0,(function*(){const t="/api/remove-product-image?imageId="+e;return yield fetch(t).then((e=>e.json())).then((e=>{e.error||n.remove()})).catch((e=>console.log(e)))}))}}).listenEvent()})();