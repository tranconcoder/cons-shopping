(()=>{"use strict";const e=(e,t=document)=>t.querySelector(e),t=(e,t=document)=>t.querySelectorAll(e);var n=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{s(i.next(e))}catch(e){o(e)}}function d(e){try{s(i.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,d)}s((i=i.apply(e,t||[])).next())}))};(new class{constructor(){this.changeInfoPreviousValue="",this.updateImageBoxStateInput=e("#update-image-box-state"),this.inputFileImageList=t(".home-image-slide tbody .thumb input"),this.updateImagePreviewImg=e("#preview-img"),this.updateImageBoxAcceptButton=e(".update-image-box .button-list .accept"),this.removeImageButtonList=t(".home-image-slide tbody tr .action > button"),this.imageInfoInputList=t('.home-image-slide tbody tr td input[type="text"] , .home-image-slide tbody tr td input[type="number"]')}listenEvent(){this.inputFileImageList.forEach((e=>{e.addEventListener("change",this.handleChangeFileInput.bind(this))})),this.removeImageButtonList.forEach((e=>{e.addEventListener("click",this.removeImageSlide.bind(this))})),this.updateImageBoxAcceptButton.addEventListener("click",(t=>{var n,i;const a=e(`input[data-id="${this.updateImagePreviewImg.dataset.id}"]`);(null===(n=a.files)||void 0===n?void 0:n.length)&&(null===(i=this.updateImagePreviewImg.dataset.id)||void 0===i?void 0:i.length)&&this.submitNewImage(null==a?void 0:a.files[0],a.dataset.id)})),this.imageInfoInputList.forEach((e=>{e.addEventListener("focusin",(e=>{this.changeInfoPreviousValue=e.target.value}))})),this.imageInfoInputList.forEach((e=>{e.addEventListener("change",this.changeImageInfo.bind(this))}))}handleChangeFileInput(e){const t=e.target.files[0],n=URL.createObjectURL(t),i=e.target.previousElementSibling;this.updateImageBoxStateInput.checked=!0,this.updateImagePreviewImg.src=n,this.updateImagePreviewImg.dataset.id=e.target.dataset.id,i.src=n}submitNewImage(e,t){const n=new FormData;n.append("id",t),n.append("file",e),fetch("/api/change-image-slider",{method:"POST",body:n}).then((e=>e.json())).then((e=>{!0===e&&(alert("Success!"),this.updateImageBoxStateInput.checked=!1)})).catch((e=>console.log(e)))}removeImageSlide(e){if(!confirm("Bạn có muốn xóa ảnh này không?"))return;const t=e.target.dataset.id,n=new FormData;n.append("imageId",t),fetch("/api/remove-image-slider",{method:"POST",body:n}).then((e=>e.json())).then((t=>{!t.error&&t&&e.target.parentElement.parentElement.remove()}))}changeImageInfo(e){const t=e.target,n=(t.name,t.value);let i=t;for(;!(i instanceof HTMLTableRowElement);)i=i.parentNode;const a=i.dataset.id,o=new FormData;o.append("imageId",a),o.append("field",t.name),o.append("newValue",n.toString()),fetch("/api/update-info-image-slider",{method:"POST",body:o}).then((e=>e.json())).then((e=>{"Error: Order is used"==e.message&&(confirm("STT mới đã được sử dụng, bạn có muốn hoán đổi vị trí 2 ảnh này không?")?this.handleSwapOrderImage(n,this.changeInfoPreviousValue):t.value=this.changeInfoPreviousValue)})).catch((e=>console.error("Error: ",e)))}handleSwapOrderImage(e,t){const n=new FormData;n.append("order1",e.toString()),n.append("order2",t.toString()),fetch("/api/swap-order-image-slider",{method:"POST",body:n}).then((e=>e.json())).then((e=>{e.error||window.location.reload()})).catch((e=>console.log(e)))}}).listenEvent(),(new class{constructor(){this.addNewImageForm=e(".home-image-slide form.add-new-image"),this.imageNameInput=e('input[type="text"]',this.addNewImageForm),this.imageFileInput=e('input[type="file"]',this.addNewImageForm),this.submitNewImageButton=e("button.submit",this.addNewImageForm)}listenEvent(){this.imageNameInput.addEventListener("focusout",(t=>{var n;const i=t.target,a=null===(n=i.parentElement)||void 0===n?void 0:n.parentElement,o=e(".error-message",a);i.value.length?a.classList.remove("error"):(a.classList.add("error"),o.textContent="Vui lòng nhập tên hình ảnh!")})),this.addNewImageForm.addEventListener("submit",(t=>{var n;t.preventDefault();const i=t.target,a=null===(n=this.imageNameInput.parentElement)||void 0===n?void 0:n.parentElement,o=e(".error-message",a);this.imageNameInput.value.length?i.submit():(a.classList.add("error"),o.textContent="Vui lòng nhập tên hình ảnh!")}))}}).listenEvent(),(new class{constructor(){this.addProductForm=e("form.add-product-box-ctn"),this.addProductButton=e(".add-product-button"),this.imageFilesInput=e('input[name="file[]"]'),this.imageListPreview=e("ul.image-list")}listenEvent(){this.addProductButton.addEventListener("click",this.handleOpenBox.bind(this)),this.imageFilesInput.addEventListener("change",this.handleChangeInputFiles.bind(this))}handleOpenBox(){return e=this,t=void 0,i=function*(){this.addProductForm.reset()},new((n=void 0)||(n=Promise))((function(a,o){function r(e){try{s(i.next(e))}catch(e){o(e)}}function d(e){try{s(i.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,d)}s((i=i.apply(e,t||[])).next())}));var e,t,n,i}handleChangeInputFiles(e){this.imageListPreview.innerHTML="";const t=e.target,n=["image/jpeg","image/png","image/jpg"];let i=[...t.files];i=i.filter((e=>n.includes(e.type)));for(let e of i){const t=URL.createObjectURL(e),n=document.createElement("li"),i=document.createElement("img");i.src=t,n.appendChild(i),this.imageListPreview.appendChild(n)}}}).listenEvent(),(new class{constructor(){this.productImagesRow=e("section.section-2 table tbody tr"),this.productListItem=t(".product-list-container .product-item"),this.addProductImageInput=e("#add-product-image"),this.changeProductInfoForm=e(".change-product-info form.box")}listenEvent(){this.productListItem.forEach((t=>{e("button.delete",t).addEventListener("click",this.handleRemoveItem.bind(this))})),this.productListItem.forEach((t=>{e("label.change-info",t).addEventListener("click",this.handleOpenChangeBox.bind(this))})),this.productImagesRow.addEventListener("change",this.handleChangeImage.bind(this)),this.productImagesRow.addEventListener("click",this.handleRemoveImage.bind(this)),this.addProductImageInput.addEventListener("change",this.handleAddProductImage.bind(this))}handleRemoveItem(e){if(!confirm("Bạn có muốn XÓA sản phẩm khỏi danh sách không?"))return;const t=e.target.parentElement,n=t.dataset.id,i=new FormData;i.append("productId",n),fetch("/api/remove-product",{method:"POST",body:i}).then((e=>e.json())).then((e=>{e.error||t.remove()})).catch((e=>console.log(e)))}handleOpenChangeBox(t){return n(this,void 0,void 0,(function*(){var n,i,a,o,r,d,s,c;let h=t.target;for(;!(h instanceof HTMLLIElement);)h=h.parentElement;const l=h.dataset.id,m=e("#change-product-info-state + .change-product-info"),u=yield this.getProductInfo(l),g=yield this.getAllDeal(),p=yield this.getProductImages(l),v=e('input[name="productId"]'),I=e("img.thumb",m),f=e('input[name="label"]',m),b=e('input[name="cost"]',this.changeProductInfoForm),E=e('select[name="deal"]',this.changeProductInfoForm);I.src=u.thumb||"",b.value=u.cost.toString(),f.value=u.label,g.forEach((e=>{const t=document.createElement("option");t.value=e.dealId,t.innerText=e.title,e.dealId===u.dealId&&(t.selected=!0),E.appendChild(t)})),v.value=l,this.productImagesRow.innerHTML="<th>Hình ảnh</th>",p.forEach((e=>{const t=document.createElement("td");t.innerHTML=`\n                <span>\n                    <i class="fa-solid fa-xmark"></i>\n                </span>\n\n                <label>\n                    <input\n                        type="file"\n                        accept="image/png, image/jpg, image/jpeg"\n                        hidden\n                    />\n                    <img src="${e.source}" />\n                </label>\n            `,t.dataset.id=e.imageId,this.productImagesRow.appendChild(t)}));const w=e('input[name="sizeWidth"]',this.changeProductInfoForm),L=e('input[name="sizeHeight"]',this.changeProductInfoForm),P=e('input[name="monitorWidth"]',this.changeProductInfoForm),y=e('input[name="monitorHeight"]',this.changeProductInfoForm),F=e('input[name="processor"]',this.changeProductInfoForm),S=e('input[name="memory"]',this.changeProductInfoForm),x=e('input[name="storage"]',this.changeProductInfoForm),T=e('input[name="color"]',this.changeProductInfoForm);w.value=(null===(n=u.sizeWidth)||void 0===n?void 0:n.toString())||"",L.value=(null===(i=u.sizeHeight)||void 0===i?void 0:i.toString())||"",P.value=(null===(a=u.monitorWidth)||void 0===a?void 0:a.toString())||"",y.value=(null===(o=u.monitorHeight)||void 0===o?void 0:o.toString())||"",F.value=(null===(r=u.processor)||void 0===r?void 0:r.toString())||"",S.value=(null===(d=u.memory)||void 0===d?void 0:d.toString())||"",x.value=(null===(s=u.storage)||void 0===s?void 0:s.toString())||"",T.value=(null===(c=u.color)||void 0===c?void 0:c.toString())||""}))}handleChangeImage(t){if(!confirm("Xác nhận đổi ảnh mới?"))return;const n=t.target;let i=n;for(;!(i instanceof HTMLTableCellElement);)i=i.parentElement;const a=e("img",i),o=i.dataset.id,r=(null==n?void 0:n.files)[0],d=new FormData;d.append("imageFile",r),d.append("imageId",o),fetch("/api/change-image",{method:"POST",body:d}).then((e=>e.json())).then((e=>{e.error||(a.src=URL.createObjectURL(r))})).catch((e=>console.log(e)))}handleRemoveImage(e){var t;let n=e.target;for(;!(n instanceof HTMLSpanElement||n instanceof HTMLTableRowElement);)n=n.parentElement;if("span"!==n.tagName.toLowerCase())return;let i=n;for(;!(i instanceof HTMLTableCellElement);)i=i.parentElement;const a=i.dataset.id;if(((null===(t=i.parentElement)||void 0===t?void 0:t.childElementCount)||1)-1<2)return alert("Phải để lại ít nhất 1 hình ảnh cho mỗi sản phẩm!");this.removeImage(a,i)}handleAddProductImage(t){const n=t.target,i=e('input[name="productId"]').value,a=new FormData,o=(null==n?void 0:n.files)[0];a.append("file",o),a.append("productId",i),fetch("/api/add-product-image",{method:"POST",body:a}).then((e=>e.json())).then((e=>{if(!e.error){const t=document.createElement("td");t.innerHTML=`\n                        <span>\n                            <i class="fa-solid fa-xmark"></i>\n                        </span>\n\n                        <label>\n                            <input\n                                type="file"\n                                accept="image/png, image/jpg, image/jpeg"\n                                hidden\n                            />\n                            <img src="${URL.createObjectURL(o)}" />\n                        </label>\n                    `,t.dataset.id=e.newId,this.productImagesRow.appendChild(t)}})).catch((e=>console.log(e)))}getAllDeal(){return n(this,void 0,void 0,(function*(){return fetch("/api/get-all-deal").then((e=>e.json())).then((e=>e))}))}getProductImages(e){return n(this,void 0,void 0,(function*(){return fetch("/api/get-product-images?productId="+e).then((e=>e.json())).then((e=>e)).catch((e=>console.log(e)))}))}getProductInfo(e){return n(this,void 0,void 0,(function*(){const t="/api/get-product?productId="+e;return yield fetch(t).then((e=>e.json())).then((e=>e[0])).catch((e=>console.error(e)))}))}removeImage(e,t){return n(this,void 0,void 0,(function*(){const n="/api/remove-product-image?imageId="+e;return yield fetch(n).then((e=>e.json())).then((e=>{e.error||t.remove()})).catch((e=>console.log(e)))}))}}).listenEvent()})();